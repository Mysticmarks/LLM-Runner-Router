#!/bin/bash
# Post-bash hook - runs after Claude executes bash commands

# Check exit status and provide helpful feedback
if [ "$CLAUDE_BASH_EXIT_CODE" -ne 0 ]; then
    echo "âŒ Command failed with exit code: $CLAUDE_BASH_EXIT_CODE"
    
    # Provide specific guidance for common failures
    case "$CLAUDE_BASH_COMMAND" in
        *"npm test"*)
            echo "ðŸ’¡ Test failure - check test logs above"
            echo "ðŸ”§ Try: npm run test:watch for continuous testing"
            ;;
        *"npm install"*)
            echo "ðŸ’¡ Install failure - check package.json and network"
            echo "ðŸ”§ Try: npm cache clean --force && npm install"
            ;;
        *"npm start"*|*"npm run dev"*)
            echo "ðŸ’¡ Start failure - check port availability and dependencies"
            echo "ðŸ”§ Try: lsof -i :3000 to check port usage"
            ;;
        *"node"*)
            echo "ðŸ’¡ Node execution failure - check syntax and imports"
            echo "ðŸ”§ Try: node --check $file to validate syntax"
            ;;
    esac
else
    # Success cases - provide next step suggestions
    case "$CLAUDE_BASH_COMMAND" in
        *"npm install"*)
            echo "âœ… Dependencies installed successfully"
            echo "ðŸ’¡ Next: npm run dev to start development"
            ;;
        *"npm test"*)
            echo "âœ… All tests passed"
            echo "ðŸ’¡ Coverage report: npm run test:coverage"
            ;;
        *"npm run build"*)
            echo "âœ… Build completed successfully"
            echo "ðŸ’¡ Check build artifacts in dist/ or build/"
            ;;
    esac
fi

# Log command execution for debugging
echo "$(date): $CLAUDE_BASH_COMMAND [exit: $CLAUDE_BASH_EXIT_CODE]" >> .claude/command-history.log